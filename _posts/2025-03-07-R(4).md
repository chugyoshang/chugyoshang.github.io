---
layout: post
title: R-4
date: 2025-03-07 09:00 +0900
last_modified_at: 2025-03-07 14:00 +0900
categories: [R]
tags: [바이오메디컬, AI, 건양대학교병원, 개발과정, R]
toc: true
---

📌 R 데이터 과학: Tidyverse와 dplyr 활용법 정리
✅ 패키지 설치 및 로딩
text
install.packages("tidyverse")
library(tidyverse)
1️⃣ dplyr 기본 함수 사용법
데이터 준비
text
data <- data.frame(
  x1 = 1:6,
  x2 = c(1, 2, 2, 3, 1, 2),
  x3 = c("F", "B", "C", "E", "A", "D")
)
열 선택 및 제외
text
select(data, x1, x2) # 특정 열 선택
select(data, -x1) # 특정 열 제외
정렬 (arrange)
text
arrange(data, x3) # 열 기준 오름차순 정렬
arrange(data, desc(x1)) # 내림차순 정렬
행 필터링 (filter)
text
filter(data, x2 == 2)
filter(data, x1 > 4 & x2 == 1)
파생변수 생성 (mutate)
text
data <- mutate(data, x4 = x1 + x2)
mutate(data,
       x5 = x4 / 100,
       x6 = x4 * x2)
열 이름 변경 (rename)
text
rename(data, new_name = x3)
요약 (summarise)
text
summarise(data, avg_x2 = mean(x2))
그룹별 요약 (group_by & summarise)
text
grouped_data <- group_by(data, x2)
summarise(grouped_data,
          average_x1 = mean(x1),
          count = n())
2️⃣ 파이프 연산자 %>% 활용법
text
data %>%
  arrange(x1) %>%
  filter(x2 == 1)

data %>%
  group_by(x2) %>%
  summarise(mean_x1 = mean(x1)) -> new_data
new_data
3️⃣ 특수 파이프 연산자 사용 예시 (%T>%, %<>%)
text
mtcars %>%
  filter(mpg > 20) %T>% 
  print() %>%
  summarise(avg_hp = mean(hp))

x <- c(-3, 2, -1, 4)
x %<>% abs %>% sort
print(x)
📌 실습 문제 예시와 풀이
문제: 나이가 30 이상인 사람만 선택 후 내림차순 정렬
text
df <- tibble(
  id = 1:5,
  name = c("대한", "민국", "만세", "영원", "무궁"),
  age = c(25,30,35,40,45),
  gender = c("Male","Male","Male","Female","Female")
)

filtered <- df %>%
              filter(age >=30) %>%
              arrange(desc(age))
filtered
문제: 성별로 그룹핑 후 평균 나이 계산
text
df_summary <- df %>%
                group_by(gender) %>%
                summarise(avg_age = mean(age))
df_summary
문제: 나이를 개월 단위로 변환
text
df <- df %>%
        mutate(age_in_months = age *12)
df
📌 데이터 형태 변환 (pivot_longer)
text
wide_data <- data.frame(
 학생=c("철수","영희"),
 수학=c(80,85),
 영어=c(90,95),
 과학=c(85,80)
)

long_data <- wide_data %>%
               pivot_longer(cols=-학생,names_to="과목",values_to="점수")
long_data
📌 결측치 처리 방법
데이터 준비

text
df <- tibble(
 학생=c("철수","영희","민수","지혜"),
 수학=c(80,NA,75,90),
 영어=c(85,90,NA,95),
 과학=c(NA,80,70,85)
)
결측치 제거 및 대체

text
# 결측치 제거 (모든 결측치 행 제거)
df_no_na <- df %>% drop_na()

# 특정 열 기준 결측치 제거 
df_no_na_specific <- df %>% drop_na(과학)

# 결측치를 특정 값으로 대체 (0으로 대체)
df_replace_zero <- df %>%
                    replace_na(list(수학=0, 영어=0, 과학=0))

# 결측치를 평균값으로 대체 
df_replace_mean <- df %>%
                    mutate(
                      수학=replace_na(수학,mean(수학,na.rm=T)),
                      영어=replace_na(영어,mean(영어,na.rm=T)),
                      과학=replace_na(과학,mean(과학,na.rm=T))
                    )

# 이전 값으로 채우기 (fill down/up)
df_fill_down <- df %>% fill(수학,.direction="down")
df_fill_up <- df %>% fill(수학,.direction="up")
📌 데이터베이스 연동 예시 (DBI, dbplyr, RMariaDB)
SQLite 예시

text
library(DBI)
library(RSQLite)

con <- dbConnect(RSQLite::SQLite(),":memory:")
copy_to(con,mtcars,"mtcars_table")

db_tbl <- tbl(con,"mtcars_table")
result <- db_tbl %>%
            filter(mpg >20) %>%
            summarise(mean_hp=mean(hp))

show_query(result)

dbDisconnect(con)
MariaDB(MySQL) 예시

text
library(RMariaDB)

con <- dbConnect(
 RMariaDB::MariaDB(),
 dbname="daejeon",
 host="34.64.164.192",
 port=3306,
 user="lsy",
 password="lee338833"
)

student=dbReadTable(con,"student")
student %>%
 select(kor,mat,eng) %>%
 summarise(across(c(kor,mat,eng),~round(mean(.x),2)))

dbDisconnect(con)
📌 hflights 데이터 분석 예제
데이터 로딩 및 분석

text
library(hflights)
hflights_df<-as_tibble(hflights)

hflights_df %>%
 group_by(Dest) %>%
 summarise(
   planes=n_distinct(TailNum),
   flights=n()
 )
📌 연습 문제 풀이 예시
급여 데이터 프레임 생성 및 분석

text
pay201801<-data.frame(empno=101:105,
                      pay=c(250,180,200,300,1000),
                      bonus=c(0.10,.10,.12,.15,.00))

pay201801<-mutate(pay201801,total=pay+pay*bonus)

ggplot(pay201801,aes(x=empno,y=pay))+geom_col()

pay201801%>%filter(total>=300)%>%select(empno,total)

pay201801<-mutate(pay201801,
                  deptno=c(1,2,1,2,2))

pay201801%>%group_by(deptno)%>%summarize(mean_total=mean(total))

## 결론 및 앞으로의 계획

이번 포스팅에서는 R 프로그래밍에서 가장 활발히 사용되는 Tidyverse 생태계와 그 중에서도 특히 dplyr 패키지의 주요 기능들을 살펴보았습니다. 데이터 전처리와 변형을 위한 필수 함수들(select, filter, mutate, summarise, group_by)과 파이프 연산자(%>%)를 활용한 효율적인 코드 작성법을 실습했습니다.

또한 결측치 처리, 데이터 형태 변환(pivot_longer), 데이터베이스 연동(DBI, dbplyr, RMariaDB) 등 실무에서 자주 접하게 되는 기술들을 예제를 통해 익혔습니다.