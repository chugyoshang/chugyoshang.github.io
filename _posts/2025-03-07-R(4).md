---
layout: post
title: R-4
date: 2025-03-07 09:00 +0900
last_modified_at: 2025-03-07 14:00 +0900
categories: [R]
tags: [ë°”ì´ì˜¤ë©”ë””ì»¬, AI, ê±´ì–‘ëŒ€í•™êµë³‘ì›, ê°œë°œê³¼ì •, R]
toc: true
---

ğŸ“Œ R ë°ì´í„° ê³¼í•™: Tidyverseì™€ dplyr í™œìš©ë²• ì •ë¦¬
âœ… íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ë¡œë”©
text
install.packages("tidyverse")
library(tidyverse)
1ï¸âƒ£ dplyr ê¸°ë³¸ í•¨ìˆ˜ ì‚¬ìš©ë²•
ë°ì´í„° ì¤€ë¹„
text
data <- data.frame(
  x1 = 1:6,
  x2 = c(1, 2, 2, 3, 1, 2),
  x3 = c("F", "B", "C", "E", "A", "D")
)
ì—´ ì„ íƒ ë° ì œì™¸
text
select(data, x1, x2) # íŠ¹ì • ì—´ ì„ íƒ
select(data, -x1) # íŠ¹ì • ì—´ ì œì™¸
ì •ë ¬ (arrange)
text
arrange(data, x3) # ì—´ ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
arrange(data, desc(x1)) # ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
í–‰ í•„í„°ë§ (filter)
text
filter(data, x2 == 2)
filter(data, x1 > 4 & x2 == 1)
íŒŒìƒë³€ìˆ˜ ìƒì„± (mutate)
text
data <- mutate(data, x4 = x1 + x2)
mutate(data,
       x5 = x4 / 100,
       x6 = x4 * x2)
ì—´ ì´ë¦„ ë³€ê²½ (rename)
text
rename(data, new_name = x3)
ìš”ì•½ (summarise)
text
summarise(data, avg_x2 = mean(x2))
ê·¸ë£¹ë³„ ìš”ì•½ (group_by & summarise)
text
grouped_data <- group_by(data, x2)
summarise(grouped_data,
          average_x1 = mean(x1),
          count = n())
2ï¸âƒ£ íŒŒì´í”„ ì—°ì‚°ì %>% í™œìš©ë²•
text
data %>%
  arrange(x1) %>%
  filter(x2 == 1)

data %>%
  group_by(x2) %>%
  summarise(mean_x1 = mean(x1)) -> new_data
new_data
3ï¸âƒ£ íŠ¹ìˆ˜ íŒŒì´í”„ ì—°ì‚°ì ì‚¬ìš© ì˜ˆì‹œ (%T>%, %<>%)
text
mtcars %>%
  filter(mpg > 20) %T>% 
  print() %>%
  summarise(avg_hp = mean(hp))

x <- c(-3, 2, -1, 4)
x %<>% abs %>% sort
print(x)
ğŸ“Œ ì‹¤ìŠµ ë¬¸ì œ ì˜ˆì‹œì™€ í’€ì´
ë¬¸ì œ: ë‚˜ì´ê°€ 30 ì´ìƒì¸ ì‚¬ëŒë§Œ ì„ íƒ í›„ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
text
df <- tibble(
  id = 1:5,
  name = c("ëŒ€í•œ", "ë¯¼êµ­", "ë§Œì„¸", "ì˜ì›", "ë¬´ê¶"),
  age = c(25,30,35,40,45),
  gender = c("Male","Male","Male","Female","Female")
)

filtered <- df %>%
              filter(age >=30) %>%
              arrange(desc(age))
filtered
ë¬¸ì œ: ì„±ë³„ë¡œ ê·¸ë£¹í•‘ í›„ í‰ê·  ë‚˜ì´ ê³„ì‚°
text
df_summary <- df %>%
                group_by(gender) %>%
                summarise(avg_age = mean(age))
df_summary
ë¬¸ì œ: ë‚˜ì´ë¥¼ ê°œì›” ë‹¨ìœ„ë¡œ ë³€í™˜
text
df <- df %>%
        mutate(age_in_months = age *12)
df
ğŸ“Œ ë°ì´í„° í˜•íƒœ ë³€í™˜ (pivot_longer)
text
wide_data <- data.frame(
 í•™ìƒ=c("ì² ìˆ˜","ì˜í¬"),
 ìˆ˜í•™=c(80,85),
 ì˜ì–´=c(90,95),
 ê³¼í•™=c(85,80)
)

long_data <- wide_data %>%
               pivot_longer(cols=-í•™ìƒ,names_to="ê³¼ëª©",values_to="ì ìˆ˜")
long_data
ğŸ“Œ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²•
ë°ì´í„° ì¤€ë¹„

text
df <- tibble(
 í•™ìƒ=c("ì² ìˆ˜","ì˜í¬","ë¯¼ìˆ˜","ì§€í˜œ"),
 ìˆ˜í•™=c(80,NA,75,90),
 ì˜ì–´=c(85,90,NA,95),
 ê³¼í•™=c(NA,80,70,85)
)
ê²°ì¸¡ì¹˜ ì œê±° ë° ëŒ€ì²´

text
# ê²°ì¸¡ì¹˜ ì œê±° (ëª¨ë“  ê²°ì¸¡ì¹˜ í–‰ ì œê±°)
df_no_na <- df %>% drop_na()

# íŠ¹ì • ì—´ ê¸°ì¤€ ê²°ì¸¡ì¹˜ ì œê±° 
df_no_na_specific <- df %>% drop_na(ê³¼í•™)

# ê²°ì¸¡ì¹˜ë¥¼ íŠ¹ì • ê°’ìœ¼ë¡œ ëŒ€ì²´ (0ìœ¼ë¡œ ëŒ€ì²´)
df_replace_zero <- df %>%
                    replace_na(list(ìˆ˜í•™=0, ì˜ì–´=0, ê³¼í•™=0))

# ê²°ì¸¡ì¹˜ë¥¼ í‰ê· ê°’ìœ¼ë¡œ ëŒ€ì²´ 
df_replace_mean <- df %>%
                    mutate(
                      ìˆ˜í•™=replace_na(ìˆ˜í•™,mean(ìˆ˜í•™,na.rm=T)),
                      ì˜ì–´=replace_na(ì˜ì–´,mean(ì˜ì–´,na.rm=T)),
                      ê³¼í•™=replace_na(ê³¼í•™,mean(ê³¼í•™,na.rm=T))
                    )

# ì´ì „ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° (fill down/up)
df_fill_down <- df %>% fill(ìˆ˜í•™,.direction="down")
df_fill_up <- df %>% fill(ìˆ˜í•™,.direction="up")
ğŸ“Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ì˜ˆì‹œ (DBI, dbplyr, RMariaDB)
SQLite ì˜ˆì‹œ

text
library(DBI)
library(RSQLite)

con <- dbConnect(RSQLite::SQLite(),":memory:")
copy_to(con,mtcars,"mtcars_table")

db_tbl <- tbl(con,"mtcars_table")
result <- db_tbl %>%
            filter(mpg >20) %>%
            summarise(mean_hp=mean(hp))

show_query(result)

dbDisconnect(con)
MariaDB(MySQL) ì˜ˆì‹œ

text
library(RMariaDB)

con <- dbConnect(
 RMariaDB::MariaDB(),
 dbname="daejeon",
 host="34.64.164.192",
 port=3306,
 user="lsy",
 password="lee338833"
)

student=dbReadTable(con,"student")
student %>%
 select(kor,mat,eng) %>%
 summarise(across(c(kor,mat,eng),~round(mean(.x),2)))

dbDisconnect(con)
ğŸ“Œ hflights ë°ì´í„° ë¶„ì„ ì˜ˆì œ
ë°ì´í„° ë¡œë”© ë° ë¶„ì„

text
library(hflights)
hflights_df<-as_tibble(hflights)

hflights_df %>%
 group_by(Dest) %>%
 summarise(
   planes=n_distinct(TailNum),
   flights=n()
 )
ğŸ“Œ ì—°ìŠµ ë¬¸ì œ í’€ì´ ì˜ˆì‹œ
ê¸‰ì—¬ ë°ì´í„° í”„ë ˆì„ ìƒì„± ë° ë¶„ì„

text
pay201801<-data.frame(empno=101:105,
                      pay=c(250,180,200,300,1000),
                      bonus=c(0.10,.10,.12,.15,.00))

pay201801<-mutate(pay201801,total=pay+pay*bonus)

ggplot(pay201801,aes(x=empno,y=pay))+geom_col()

pay201801%>%filter(total>=300)%>%select(empno,total)

pay201801<-mutate(pay201801,
                  deptno=c(1,2,1,2,2))

pay201801%>%group_by(deptno)%>%summarize(mean_total=mean(total))

## ê²°ë¡  ë° ì•ìœ¼ë¡œì˜ ê³„íš

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” R í”„ë¡œê·¸ë˜ë°ì—ì„œ ê°€ì¥ í™œë°œíˆ ì‚¬ìš©ë˜ëŠ” Tidyverse ìƒíƒœê³„ì™€ ê·¸ ì¤‘ì—ì„œë„ íŠ¹íˆ dplyr íŒ¨í‚¤ì§€ì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤ì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ë°ì´í„° ì „ì²˜ë¦¬ì™€ ë³€í˜•ì„ ìœ„í•œ í•„ìˆ˜ í•¨ìˆ˜ë“¤(select, filter, mutate, summarise, group_by)ê³¼ íŒŒì´í”„ ì—°ì‚°ì(%>%)ë¥¼ í™œìš©í•œ íš¨ìœ¨ì ì¸ ì½”ë“œ ì‘ì„±ë²•ì„ ì‹¤ìŠµí–ˆìŠµë‹ˆë‹¤.

ë˜í•œ ê²°ì¸¡ì¹˜ ì²˜ë¦¬, ë°ì´í„° í˜•íƒœ ë³€í™˜(pivot_longer), ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™(DBI, dbplyr, RMariaDB) ë“± ì‹¤ë¬´ì—ì„œ ìì£¼ ì ‘í•˜ê²Œ ë˜ëŠ” ê¸°ìˆ ë“¤ì„ ì˜ˆì œë¥¼ í†µí•´ ìµí˜”ìŠµë‹ˆë‹¤.